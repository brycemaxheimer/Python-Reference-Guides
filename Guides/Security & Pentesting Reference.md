## Cryptography Basics

### Hashing

#### hashlib (Built-in)

```python
import hashlib

# MD5 (weak, don't use for security)
md5 = hashlib.md5(b'Hello World').hexdigest()
# '3e25960a79dbc69b674cd4ec67a72c62'

# SHA-1 (weak)
sha1 = hashlib.sha1(b'Hello World').hexdigest()

# SHA-256 (recommended)
sha256 = hashlib.sha256(b'Hello World').hexdigest()

# SHA-512 (more secure)
sha512 = hashlib.sha512(b'Hello World').hexdigest()

# Hash from file
with open('file.txt', 'rb') as f:
    file_hash = hashlib.sha256(f.read()).hexdigest()

# Incremental hashing (for large files)
hasher = hashlib.sha256()
with open('large_file.bin', 'rb') as f:
    for chunk in iter(lambda: f.read(4096), b''):
        hasher.update(chunk)
file_hash = hasher.hexdigest()
```

#### Common Hashing Patterns

```python
import hashlib

# Hash password (DON'T do this - use bcrypt/scrypt instead)
password = "secret123"
hashed = hashlib.sha256(password.encode()).hexdigest()

# Verify hash
def verify_hash(data, expected_hash):
    actual_hash = hashlib.sha256(data.encode()).hexdigest()
    return actual_hash == expected_hash

# Hash with salt (still not secure for passwords)
import os
salt = os.urandom(32)  # 32 random bytes
salted = hashlib.sha256(salt + password.encode()).hexdigest()
```

### Encryption (cryptography library)

#### Installation

```bash
pip install cryptography --break-system-packages
```

#### Symmetric Encryption (Fernet)

```python
from cryptography.fernet import Fernet

# Generate key (save this securely!)
key = Fernet.generate_key()  # b'...'

# Create cipher
cipher = Fernet(key)

# Encrypt
plaintext = b"Secret message"
ciphertext = cipher.encrypt(plaintext)
# b'gAAAAABh...'

# Decrypt
decrypted = cipher.decrypt(ciphertext)
# b'Secret message'

# Encrypt string
message = "Hello World"
encrypted = cipher.encrypt(message.encode())
decrypted = cipher.decrypt(encrypted).decode()
```

#### Password-based Encryption

```python
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64
import os

# Derive key from password
password = b"my_password"
salt = os.urandom(16)

kdf = PBKDF2HMAC(
    algorithm=hashes.SHA256(),
    length=32,
    salt=salt,
    iterations=100000,
)
key = base64.urlsafe_b64encode(kdf.derive(password))

# Use key with Fernet
cipher = Fernet(key)
encrypted = cipher.encrypt(b"Secret data")
```

#### AES Encryption (Advanced)

```python
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend
import os

# Generate key and IV
key = os.urandom(32)  # 256-bit key
iv = os.urandom(16)   # 128-bit IV

# Create cipher
cipher = Cipher(
    algorithms.AES(key),
    modes.CBC(iv),
    backend=default_backend()
)

# Encrypt
encryptor = cipher.encryptor()
plaintext = b"Secret message here!"
# Pad to block size (16 bytes)
padded = plaintext + b' ' * (16 - len(plaintext) % 16)
ciphertext = encryptor.update(padded) + encryptor.finalize()

# Decrypt
decryptor = cipher.decryptor()
decrypted = decryptor.update(ciphertext) + decryptor.finalize()
```

### Encoding (Base64)

```python
import base64

# Encode
data = b"Hello World"
encoded = base64.b64encode(data)  # b'SGVsbG8gV29ybGQ='

# Decode
decoded = base64.b64decode(encoded)  # b'Hello World'

# URL-safe encoding
url_encoded = base64.urlsafe_b64encode(data)
url_decoded = base64.urlsafe_b64decode(url_encoded)

# String encoding/decoding
text = "Hello World"
encoded_str = base64.b64encode(text.encode()).decode()
decoded_str = base64.b64decode(encoded_str).decode()
```

---

## Password Security

### Password Hashing (bcrypt)

```python
# pip install bcrypt --break-system-packages
import bcrypt

# Hash password
password = b"secret123"
salt = bcrypt.gensalt()
hashed = bcrypt.hashpw(password, salt)
# b'$2b$12$...'

# Verify password
if bcrypt.checkpw(password, hashed):
    print("Password matches!")

# With string
password_str = "secret123"
hashed = bcrypt.hashpw(password_str.encode(), bcrypt.gensalt())
if bcrypt.checkpw(password_str.encode(), hashed):
    print("Match!")
```

### Password Generation

```python
import secrets
import string

# Generate secure random password
def generate_password(length=16):
    alphabet = string.ascii_letters + string.digits + string.punctuation
    password = ''.join(secrets.choice(alphabet) for _ in range(length))
    return password

# Generate alphanumeric only
def generate_alphanum_password(length=12):
    alphabet = string.ascii_letters + string.digits
    return ''.join(secrets.choice(alphabet) for _ in range(length))

# Generate token
token = secrets.token_urlsafe(32)  # 32 bytes = 256 bits
```

---

## Network Security

### SSL/TLS Connections

```python
import ssl
import socket

# Create SSL context
context = ssl.create_default_context()

# Connect with SSL
with socket.create_connection(('example.com', 443)) as sock:
    with context.wrap_socket(sock, server_hostname='example.com') as ssock:
        ssock.send(b'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n')
        data = ssock.recv(4096)
        print(data.decode())

# With requests (automatic SSL)
import requests
response = requests.get('https://example.com')
```

### Port Scanning

```python
import socket
from concurrent.futures import ThreadPoolExecutor

def scan_port(host, port, timeout=1):
    """Check if port is open"""
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(timeout)
        result = sock.connect_ex((host, port))
        sock.close()
        return port if result == 0 else None
    except:
        return None

# Scan multiple ports
def scan_ports(host, ports):
    open_ports = []
    with ThreadPoolExecutor(max_workers=100) as executor:
        results = executor.map(lambda p: scan_port(host, p), ports)
        open_ports = [p for p in results if p is not None]
    return open_ports

# Common ports
common_ports = [21, 22, 23, 25, 80, 443, 3306, 3389, 8080]
open_ports = scan_ports('192.168.1.1', common_ports)
print(f"Open ports: {open_ports}")
```

### Banner Grabbing

```python
import socket

def grab_banner(host, port, timeout=2):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(timeout)
        sock.connect((host, port))
        
        # Try to receive banner
        banner = sock.recv(1024).decode().strip()
        sock.close()
        return banner
    except:
        return None

# Example
banner = grab_banner('example.com', 21)  # FTP
if banner:
    print(f"Banner: {banner}")
```

---

## Web Application Security

### SQL Injection Testing (Educational)

```python
# NEVER use this maliciously - for testing your own apps only

# Vulnerable code example (DON'T DO THIS)
def vulnerable_query(username):
    query = f"SELECT * FROM users WHERE username = '{username}'"
    # If username = "admin' OR '1'='1" -> SQL injection!
    return query

# Safe code (DO THIS)
def safe_query(username):
    # Use parameterized queries
    query = "SELECT * FROM users WHERE username = ?"
    # Database will safely escape the parameter
    return query

# Common SQL injection payloads (for testing)
sql_payloads = [
    "' OR '1'='1",
    "admin' --",
    "' UNION SELECT NULL--",
    "1' ORDER BY 1--",
]
```

### XSS Testing (Educational)

```python
# Common XSS payloads (for testing your own apps)
xss_payloads = [
    "<script>alert('XSS')</script>",
    "<img src=x onerror=alert('XSS')>",
    "<svg/onload=alert('XSS')>",
    "javascript:alert('XSS')",
]

# Safe HTML escaping
import html

user_input = "<script>alert('XSS')</script>"
safe_output = html.escape(user_input)
# "&lt;script&gt;alert('XSS')&lt;/script&gt;"
```

### Directory Traversal Testing

```python
# Common directory traversal payloads (for testing)
traversal_payloads = [
    "../../../etc/passwd",
    "..\\..\\..\\windows\\system32\\config\\sam",
    "%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd",  # URL encoded
]

# Safe path validation
import os

def is_safe_path(basedir, path):
    # Resolve to absolute path
    abs_basedir = os.path.abspath(basedir)
    abs_path = os.path.abspath(os.path.join(basedir, path))
    
    # Check if path is within basedir
    return abs_path.startswith(abs_basedir)

# Example
if is_safe_path('/var/www', user_provided_path):
    # Safe to access
    pass
```

---

## Data Exfiltration & Analysis

### Extract Passwords from Files

```python
import re

def find_passwords(text):
    """Find potential passwords in text"""
    patterns = [
        r'password["\']?\s*[:=]\s*["\']?(\w+)',
        r'passwd["\']?\s*[:=]\s*["\']?(\w+)',
        r'pwd["\']?\s*[:=]\s*["\']?(\w+)',
        r'api[_-]?key["\']?\s*[:=]\s*["\']?([\w-]+)',
    ]
    
    found = []
    for pattern in patterns:
        matches = re.findall(pattern, text, re.IGNORECASE)
        found.extend(matches)
    
    return found

# Example
config = """
database:
  username: admin
  password: secret123
api_key: "abc123def456"
"""
passwords = find_passwords(config)
```

### Extract Email Addresses

```python
import re

def extract_emails(text):
    pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    return re.findall(pattern, text)

# Example
text = "Contact us at info@example.com or support@test.org"
emails = extract_emails(text)  # ['info@example.com', 'support@test.org']
```

### Extract IP Addresses

```python
import re

def extract_ips(text):
    pattern = r'\b(?:\d{1,3}\.){3}\d{1,3}\b'
    return re.findall(pattern, text)

# More strict (valid IP ranges)
def extract_valid_ips(text):
    pattern = r'\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b'
    return re.findall(pattern, text)

# Example
log = "Connection from 192.168.1.100 to 10.0.0.5"
ips = extract_ips(log)
```

### Extract URLs

```python
import re

def extract_urls(text):
    pattern = r'https?://(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&/=]*)'
    return re.findall(pattern, text)

# Example
text = "Visit https://example.com or http://test.org/page"
urls = extract_urls(text)
```

---

## Log Analysis

### Parse Apache/Nginx Logs

```python
import re

def parse_apache_log(line):
    """Parse Apache/Nginx access log"""
    pattern = r'(\S+) \S+ \S+ \[(.*?)\] "(\S+) (\S+) (\S+)" (\d+) (\d+)'
    match = re.match(pattern, line)
    
    if match:
        return {
            'ip': match.group(1),
            'timestamp': match.group(2),
            'method': match.group(3),
            'path': match.group(4),
            'protocol': match.group(5),
            'status': int(match.group(6)),
            'size': int(match.group(7))
        }
    return None

# Example
log_line = '192.168.1.1 - - [01/Jan/2024:12:00:00 +0000] "GET /index.html HTTP/1.1" 200 1234'
parsed = parse_apache_log(log_line)
```

### Find Failed Login Attempts

```python
def find_failed_logins(log_file):
    """Find failed login attempts in auth log"""
    failed = []
    
    with open(log_file, 'r') as f:
        for line in f:
            if 'Failed password' in line or 'authentication failure' in line:
                failed.append(line.strip())
    
    return failed

# Count by IP
from collections import Counter

def count_failed_by_ip(log_file):
    import re
    
    ip_pattern = r'\b(?:\d{1,3}\.){3}\d{1,3}\b'
    ips = []
    
    with open(log_file, 'r') as f:
        for line in f:
            if 'Failed password' in line:
                ip_match = re.search(ip_pattern, line)
                if ip_match:
                    ips.append(ip_match.group())
    
    return Counter(ips)
```

### Detect Suspicious Activity

```python
def detect_suspicious_requests(log_file):
    """Detect potential attack patterns in web logs"""
    suspicious = []
    
    attack_patterns = [
        r'\.\./\.\.',           # Directory traversal
        r'<script',             # XSS attempt
        r'union.*select',       # SQL injection
        r'exec\(',              # Command injection
        r'/etc/passwd',         # File access
    ]
    
    with open(log_file, 'r') as f:
        for line in f:
            for pattern in attack_patterns:
                if re.search(pattern, line, re.IGNORECASE):
                    suspicious.append(line.strip())
                    break
    
    return suspicious
```

---

## Steganography

### Hide Data in Images (Simple)

```python
# pip install pillow --break-system-packages
from PIL import Image

def hide_text_in_image(image_path, text, output_path):
    """Hide text in image using LSB steganography"""
    img = Image.open(image_path)
    encoded = img.copy()
    width, height = img.size
    
    # Convert text to binary
    binary_text = ''.join(format(ord(char), '08b') for char in text)
    binary_text += '1111111111111110'  # End marker
    
    data_index = 0
    for y in range(height):
        for x in range(width):
            if data_index < len(binary_text):
                pixel = list(img.getpixel((x, y)))
                pixel[0] = (pixel[0] & ~1) | int(binary_text[data_index])
                encoded.putpixel((x, y), tuple(pixel))
                data_index += 1
    
    encoded.save(output_path)

def extract_text_from_image(image_path):
    """Extract hidden text from image"""
    img = Image.open(image_path)
    width, height = img.size
    
    binary_text = ''
    for y in range(height):
        for x in range(width):
            pixel = img.getpixel((x, y))
            binary_text += str(pixel[0] & 1)
    
    # Find end marker
    end_marker = '1111111111111110'
    end_index = binary_text.find(end_marker)
    if end_index != -1:
        binary_text = binary_text[:end_index]
    
    # Convert binary to text
    text = ''
    for i in range(0, len(binary_text), 8):
        byte = binary_text[i:i+8]
        if len(byte) == 8:
            text += chr(int(byte, 2))
    
    return text
```

---

## Reverse Engineering Basics

### Decode Obfuscated Strings

```python
import base64

# Base64 decode
encoded = "SGVsbG8gV29ybGQ="
decoded = base64.b64decode(encoded).decode()

# Hex decode
hex_str = "48656c6c6f"
decoded = bytes.fromhex(hex_str).decode()

# ROT13
def rot13(text):
    result = []
    for char in text:
        if 'a' <= char <= 'z':
            result.append(chr((ord(char) - ord('a') + 13) % 26 + ord('a')))
        elif 'A' <= char <= 'Z':
            result.append(chr((ord(char) - ord('A') + 13) % 26 + ord('A')))
        else:
            result.append(char)
    return ''.join(result)

# Caesar cipher
def caesar_decrypt(text, shift):
    result = []
    for char in text:
        if char.isalpha():
            base = ord('A') if char.isupper() else ord('a')
            result.append(chr((ord(char) - base - shift) % 26 + base))
        else:
            result.append(char)
    return ''.join(result)

# Try all shifts
def brute_force_caesar(ciphertext):
    for shift in range(26):
        print(f"Shift {shift}: {caesar_decrypt(ciphertext, shift)}")
```

### Extract Strings from Binary

```python
def extract_strings(file_path, min_length=4):
    """Extract printable strings from binary file"""
    strings = []
    current = []
    
    with open(file_path, 'rb') as f:
        for byte in f.read():
            if 32 <= byte <= 126:  # Printable ASCII
                current.append(chr(byte))
            else:
                if len(current) >= min_length:
                    strings.append(''.join(current))
                current = []
    
    if len(current) >= min_length:
        strings.append(''.join(current))
    
    return strings

# Usage
strings = extract_strings('binary_file.exe', min_length=6)
for s in strings[:10]:  # Show first 10
    print(s)
```

---

## Creating Executables (PyInstaller)

### Installation

```bash
pip install pyinstaller --break-system-packages
```

### Basic Usage

```python
# Create your Python script (example.py)
# Then run from command line:
# pyinstaller --onefile example.py

# Options:
# --onefile          : Single executable
# --noconsole        : No console window (GUI apps)
# --icon=icon.ico    : Custom icon
# --hidden-import=module : Include hidden imports
# --add-data "src:dst" : Include data files

# Example command:
# pyinstaller --onefile --noconsole --icon=app.ico script.py
```

### Sample Script for Executable

```python
# simple_tool.py
import sys

def main():
    print("Simple Security Tool")
    print("=" * 40)
    
    target = input("Enter target: ")
    print(f"Scanning {target}...")
    
    # Your tool logic here
    
    input("\nPress Enter to exit...")

if __name__ == "__main__":
    main()
```

---

## Security Best Practices

### Input Validation

```python
def validate_ip(ip):
    """Validate IP address"""
    import re
    pattern = r'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'
    return bool(re.match(pattern, ip))

def sanitize_filename(filename):
    """Remove dangerous characters from filename"""
    import re
    # Remove path separators and dangerous chars
    safe = re.sub(r'[^\w\s.-]', '', filename)
    # Remove leading dots
    safe = safe.lstrip('.')
    return safe

def validate_email(email):
    """Basic email validation"""
    import re
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return bool(re.match(pattern, email))
```

### Secure Random Numbers

```python
import secrets

# Random integer
random_int = secrets.randbelow(100)  # 0 to 99

# Random bytes
random_bytes = secrets.token_bytes(32)

# Random hex token
hex_token = secrets.token_hex(16)  # 32 hex chars

# Random URL-safe token
url_token = secrets.token_urlsafe(32)

# Random choice
import string
alphabet = string.ascii_letters + string.digits
password = ''.join(secrets.choice(alphabet) for _ in range(16))
```

---

## Quick Reference Card

```python
# Hashing
import hashlib
hash = hashlib.sha256(data.encode()).hexdigest()

# Encryption
from cryptography.fernet import Fernet
key = Fernet.generate_key()
cipher = Fernet(key)
encrypted = cipher.encrypt(data.encode())
decrypted = cipher.decrypt(encrypted).decode()

# Password hashing
import bcrypt
hashed = bcrypt.hashpw(password.encode(), bcrypt.gensalt())
verified = bcrypt.checkpw(password.encode(), hashed)

# Base64
import base64
encoded = base64.b64encode(data.encode())
decoded = base64.b64decode(encoded).decode()

# Port scanning
sock.connect_ex((host, port))  # returns 0 if open

# Secure random
import secrets
token = secrets.token_urlsafe(32)
```
